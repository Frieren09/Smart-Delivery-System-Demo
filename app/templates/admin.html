<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard | Smart Delivery</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<!-- NAVBAR -->
<nav class="navbar navbar-dark bg-dark px-4">
    <span class="navbar-brand">ðŸ“¦ Smart Delivery â€“ Admin</span>
    <a href="/logout" class="btn btn-outline-light btn-sm">Logout</a>
</nav>

<!-- MAIN CONTAINER -->
<div class="container mt-4">
    <h2 class="mb-4">Admin Orders Dashboard</h2>

    <!-- Orders will load here -->
    <div id="orders-container"></div>
</div>

<!-- JAVASCRIPT -->
<script>
function loadOrders() {
    fetch("/api/admin/orders")
        .then(response => response.json())
        .then(orders => {
            let html = "";

            if (orders.length === 0) {
                html = `<div class="alert alert-info">No orders yet.</div>`;
            }

            orders.forEach(order => {
                let itemsHtml = "";
                if (order.items) {
                    itemsHtml = order.items.map(item => `
                        <li class="list-group-item d-flex justify-content-between">
                            ${item.product_name}
                            <span>Ã— ${item.quantity}</span>
                        </li>
                    `).join("");
                }

                html += `
                <div class="card mb-3 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">Order #${order.order_id}</h5>
                        <p><strong>Customer:</strong> ${order.customer_name}</p>
                        <p><strong>Status:</strong>
                            <span class="badge ${
                                order.status === "Completed" ? "bg-success" : "bg-warning text-dark"
                            }">
                                ${order.status}
                            </span>
                        </p>
                        <ul class="list-group mb-3">${itemsHtml}</ul>

                        <!-- COMPLETE ORDER -->
                        <form method="POST" action="/admin/orders/${order.order_id}/complete" class="d-inline">
                            <button class="btn btn-success btn-sm" ${order.status === "Completed" ? "disabled" : ""}>
                                Mark Completed
                            </button>
                        </form>

                        <!-- ASSIGN RIDER -->
                        <form method="POST" action="/admin/orders/${order.order_id}/assign" class="d-inline ms-2">
                            <select name="rider_id" class="form-select d-inline w-auto">
                                {% for rider in riders %}
                                    <option value="{{ rider.rider_id }}">{{ rider.name }}</option>
                                {% endfor %}
                            </select>
                            <button class="btn btn-primary btn-sm ms-1">Assign Rider</button>
                        </form>
                    </div>
                </div>
                `;
            });

            document.getElementById("orders-container").innerHTML = html;
        });
}

// Load immediately
loadOrders();

// Auto-refresh every 5 seconds
setInterval(loadOrders, 5000);
</script>

</body>
</html>
